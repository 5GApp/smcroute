##  smcroute - static multicast routing control 

EXECS         = smcroute mcsender
MCSENDER_OBJS = mcsender.o syslog.o
SMCROUTE_OBJS = smcroute.o mroute-api.o ifvc.o cmdpkt.o ipc.o syslog.o \
                mcgroup.o parse-conf.o pidfile.o
OBJS          = $(MCSENDER_OBJS) $(SMCROUTE_OBJS)
SRCS          = $(OBJS:.o=.c)
DEPS          = $(SRCS:.c=.d)
LDLIBS        = @LIBS@

# Override default implicit rules
.c.o:
	@printf "  CC      $@\n"
	@$(CC) $(CFLAGS) $(CPPFLAGS) -c -MMD -MP -o $@ $<

# Build rules
all: $(EXECS)

install: all
	@install -d $(DESTDIR)$(sbindir)
	@for file in $(EXECS); do \
		install -m 0755 $$file $(DESTDIR)$(sbindir)/$$file; \
	done

uninstall:
	-@for file in $(EXECS); do \
		$(RM) $(DESTDIR)$(sbindir)/$$file; \
	done

build.h:  
	@echo '#define BUILD "' `date +%y%m%d` '"' >build.h

config.h:
	@echo "Please run ./configure first"

mcsender:  $(MCSENDER_OBJS) config.h
	@printf "  LINK    $@\n"
	@$(CC) $(CFLAGS) $(LDFLAGS) -o $@ $(MCSENDER_OBJS) $(LDLIBS)

$(SMCROUTE_OBJS): build.h config.h

smcroute: $(SMCROUTE_OBJS)
	@printf "  LINK    $@\n"
	@$(CC) $(CFLAGS) $(LDFLAGS) -o $@ $(SMCROUTE_OBJS) $(LDLIBS)

check:
	$(CHECK) $(CHECK_FLAGS) $(CPPFLAGS) $(SRCS)

clean:
	-@$(RM) build.h $(SMCROUTE_OBJS) $(MCSENDER_OBJS) $(EXECS)

distclean: clean
	-@$(RM) *~ .bak DEADJOE semantic.cache *.gdb *.elf core core.* *.d
	-@$(RM) config.h Makefile

# Include automatically generated rules
-include $(DEPS)
